<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>writ in water</title>
        <base href="/" target="_top">
        <style type="text/css">
            :root {
                --page-color: #171717;
                --text-color: #cccccc;
                --mark-color: #47ebc8;
                --grid-color: #282828;
            }
            :focus {
                outline: 0;
            }
            body {
                height: 100vh;
                margin: 0;
                background: var(--page-color);
                color: var(--text-color);
                position: relative;
                font-family: "inconsolata", monospace;
            }
            a, .a {
                color: var(--mark-color);
                text-decoration: none;
                cursor: pointer;
            }
            .wrapper {
                margin: auto;
                width: 60vw;
                position: relative;
                top: 50%;
                transform: translateY(-50%);
            }
        </style>
    </head>
    <body>
        <div class="wrapper">
            <div id="auth"></div>
            <div id="content"></div>
        </div>
    </body>
    <script>
        const auth_el = document.getElementById("auth");
        const login_el = document.createElement('div');
        login_el.innerHTML = `<a href="https://github.com/login/oauth/authorize?client_id=22885b3bab10b44086a2">log in with github</a>`;
        const logout_el = document.createElement('div');
        logout_el.innerHTML = `<div class="a">log out</div>`;
        logout_el.onclick = logout;
        const save_el = document.createElement('div');

        var old_data = {};
        var data = {};
        fetch('https://idelem.github.io/writinwater/data.json')
            .then(res => res.json()
            .then(json => {data = json; old_data = json; mount(); }));

        var token = localStorage.getItem("wiw_token");
        
        window.onload = () => {
            if(token != null) {
                login();
                // document.getElementById("content").innerText = token;
            }
            else {
                logout();
            }
        }

        function login () {
            auth_el.innerHTML = '';
            auth_el.appendChild(logout_el);
        }
        
        function logout () {
            localStorage.removeItem("wiw_token");
            auth_el.innerHTML = '';
            auth_el.appendChild(login_el);
        }

        function mount () {
            const content_el = document.getElementById('content');
            data.entries.forEach(element => {
                var p_el = document.createElement('p');
                p_el.innerText = element;
                p_el.setAttribute("contentEditable", true);
                content_el.appendChild(p_el);
            });
        }
        
    </script>
</html>